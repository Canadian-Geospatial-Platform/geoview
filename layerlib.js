function listenToLegendLayerSetChanges(e,t){const l=t.split("/")[0];cgpv.api.maps[l].layer.legendsLayerSet.onLayerSetUpdated(((t,l)=>{const{resultSet:a}=l,n='<table class="state"><tr class="state"><th class="state">Name</th><th class="state">Status</th></tr>',d=document.getElementById(e),i=Object.keys(a).reduce(((e,t)=>{const l=a[t]?.layerName||"",{layerStatus:n}=a[t];return`${e}<tr class="state"><td class="state">${l}</td><td class="state">${n}</td></tr>`}),n);d.innerHTML=i&&i!==n?`${i}</table>`:""}))}const addBoundsPolygon=(e,t)=>{const l=cgpv.api.utilities.projection.transformAndDensifyExtent(t,`EPSG:${cgpv.api.maps[e].getMapState().currentProjection}`,"EPSG:4326"),{geometry:a}=cgpv.api.maps[e].layer;a.setActiveGeometryGroup(),a.deleteGeometriesFromGroup(0);cgpv.api.maps[e].layer.geometry.addPolygon([l],{style:{strokeColor:"#000",strokeWidth:5,strokeOpacity:.8}})},createInfoTable=(e,t,l,a)=>{if(!["click","all-features"].includes(a))return;const n=document.getElementById(`${t}-${a}`);n.textContent="";const d=document.getElementById(`layer${e.slice(-1)}-${a}-info`);d&&d.remove();const i=document.createElement("div");i.id=`layer${e.slice(-1)}-${a}-info`,n.appendChild(i),Object.keys(l).forEach((t=>{const a=l[t].features,n=document.createElement("h1");if(n.innerText=a?a?.length?t:`${t} (empty)`:`${t} (error)`,i.appendChild(n),a?.length){let t=document.createElement("h2");t.innerText="Aliases and types",i.appendChild(t);let l=document.createElement("table");l.classList.add("info"),i.appendChild(l);let n=document.createElement("tr");n.classList.add("info"),l.appendChild(n);let d=document.createElement("th");d.classList.add("infoCol1"),n.appendChild(d),Object.keys(a[0].fieldInfo).forEach((e=>{d=document.createElement("th"),d.classList.add("info"),d.innerText=e,n.appendChild(d)})),n=document.createElement("tr"),n.classList.add("info"),l.appendChild(n),d=document.createElement("td"),d.classList.add("infoCol1"),d.innerText="Aliases =>",n.appendChild(d),Object.keys(a[0].fieldInfo).forEach((e=>{d=document.createElement("td"),d.classList.add("info"),d.innerText=a[0].fieldInfo[e].alias,n.appendChild(d)})),n=document.createElement("tr"),n.classList.add("infoCol1"),l.appendChild(n),d=document.createElement("td"),d.classList.add("infoCol1"),d.innerText="Types =>",n.appendChild(d),Object.keys(a[0].fieldInfo).forEach((e=>{d=document.createElement("td"),d.classList.add("info"),d.innerText=a[0].fieldInfo[e].dataType,n.appendChild(d)})),t=document.createElement("h2"),t.innerText="Data",i.appendChild(t),l=document.createElement("table"),l.classList.add("info"),i.appendChild(l);let s=!0;a.forEach((t=>{s&&(n=document.createElement("tr"),n.classList.add("info"),l.appendChild(n),d=document.createElement("th"),d.classList.add("infoCol1"),d.innerText="Symbology",n.appendChild(d),d=document.createElement("th"),d.classList.add("infoCol1"),d.innerText="Zoom To",n.appendChild(d),Object.keys(t.fieldInfo).forEach((e=>{d=document.createElement("th"),d.classList.add("info"),d.innerText=e,n.appendChild(d)})),s=!1),n=document.createElement("tr"),n.classList.add("info"),l.appendChild(n),d=document.createElement("td"),d.classList.add("info"),d.appendChild(t.featureIcon),n.appendChild(d),d=document.createElement("td"),d.classList.add("info"),n.appendChild(d);const a=document.createElement("button");a.innerText="Zoom To Feature",a.addEventListener("click",(l=>{cgpv.api.maps[e].zoomToExtent(t.extent),addBoundsPolygon(e,t.extent)})),d.appendChild(a),Object.keys(t.fieldInfo).forEach((e=>{if(d=document.createElement("td"),d.classList.add("info"),"date"===t.fieldInfo[e].dataType){const{dateUtilities:l}=cgpv.api;d.innerText=t.fieldInfo[e].value}else d.innerText=t.fieldInfo[e].value;n.appendChild(d)}))}))}i.appendChild(document.createElement("br")),i.appendChild(document.createElement("hr"))}))},createTableOfFilter=e=>{let t=document.getElementById(`layer${e.slice(-1)}-buttons-pre`);const l=document.getElementById(`layer${e.slice(-1)}-buttons-table`);l&&l.remove();const a=document.createElement("table");a.id=`layer${e.slice(-1)}-buttons-table`,a.style.width="100%",a.border="1px solid black",t.appendChild(a);let n=cgpv.api.maps?.[e]?.layer?.getGeoviewLayers();n&&0!==n.length&&n.forEach((l=>{cgpv.api.maps[e].layer.getLayerEntryConfigIds().forEach((n=>{if(n.startsWith(l.getGeoviewLayerId())){const d=cgpv.api.maps[e].layer.getLayerEntryConfig(n);cgpv.api.utilities.geo.getLegendStylesFromConfig(d.style).then((i=>{t=document.createElement("td"),t.border="1px solid black",a.appendChild(t);const s=document.createElement("h1");s.innerText=l.getGeoviewLayerName(),t.appendChild(s);const o=document.createElement("h2");o.innerText=`${d?.layerName}`,o.style.height="15px",t.appendChild(o);const c=document.createElement("button");let r=l.getVisible(n);c.innerText=r?void 0===d?.source?.style?"Hide":`Hide style ${d.source.style}`:void 0===d?.source?.style?"Show":`Show style ${d.source.style}`,c.addEventListener("click",(e=>{r=!l.getVisible(n),c.innerText=r?void 0===d?.source?.style?"Hide":`Hide style ${d.source.style}`:void 0===d?.source?.style?"Show":`Show style ${d.source.style}`,l.setVisible(r,n)})),o.appendChild(c),d.style&&Object.keys(d.style).forEach((a=>{const s=document.createElement("p");if(s.innerText=`Geometry = ${a}`,s.style.height="15px",t.appendChild(s),"uniqueValue"===d.style[a].styleType){if(d.style[a].defaultSettings){const s=document.createElement("button");!0===d.style[a].defaultVisible?s.innerText=`Hide ${d.style[a].defaultLabel}`:!1===d.style[a].defaultVisible&&(s.innerText=`Show ${d.style[a].defaultLabel}`),s.addEventListener("click",(t=>{!0===d.style[a].defaultVisible?(d.style[a].defaultVisible=!1,s.innerText=`Show ${d.style[a].defaultLabel}`):!1===d.style[a].defaultVisible&&(d.style[a].defaultVisible=!0,s.innerText=`Hide ${d.style[a].defaultLabel}`);const i=document.getElementById(`checkbox-${e}-${l.getGeoviewLayerId()}`),o=document.getElementById(`filter-input-${e}-${l.getGeoviewLayerId()}`),c="true"===i.value?o.value:l.getLayerFilter(n);l.applyViewFilter(n,c,"true"!==i.value)})),t.appendChild(s),t.appendChild(i[a].defaultCanvas);const o=document.createElement("br");o.style.height="1px",t.appendChild(o)}for(let s=0;s<d.style[a].uniqueValueStyleInfo.length;s++){const o=document.createElement("button");!0===d.style[a].uniqueValueStyleInfo[s].visible?o.innerText=`Hide ${d.style[a].uniqueValueStyleInfo[s].label}`:!1===d.style[a].uniqueValueStyleInfo[s].visible&&(o.innerText=`Show ${d.style[a].uniqueValueStyleInfo[s].label}`),o.addEventListener("click",(t=>{const i=d.style[a].uniqueValueStyleInfo[s];!0===i.visible?(i.visible=!1,o.innerText=`Show ${i.label}`):!1===i.visible&&(i.visible=!0,o.innerText=`Hide ${i.label}`);const c=document.getElementById(`checkbox-${e}-${l.getGeoviewLayerId()}`),r=document.getElementById(`filter-input-${e}-${l.getGeoviewLayerId()}`),u="true"===c.value?r.value:l.getLayerFilter(n);l.applyViewFilter(n,u,"true"!==c.value)})),t.appendChild(o),t.appendChild(i[a].arrayOfCanvas[s]);const c=document.createElement("br");c.style.height="1px",t.appendChild(c)}}else if("classBreaks"===d.style[a].styleType){if(d.style[a].defaultSettings){const i=document.createElement("button");!0===d.style[a].defaultVisible?i.innerText=`Hide ${d.style[a].defaultLabel}`:!1===d.style[a].defaultVisible&&(i.innerText=`Show ${d.style[a].defaultLabel}`),i.addEventListener("click",(t=>{!0===d.style[a].defaultVisible?(d.style[a].defaultVisible=!1,i.innerText=`Show ${d.style[a].defaultLabel}`):!1===d.style[a].defaultVisible&&(d.style[a].defaultVisible=!0,i.innerText=`Hide ${d.style[a].defaultLabel}`);const s=document.getElementById(`checkbox-${e}-${l.getGeoviewLayerId()}`),o=document.getElementById(`filter-input-${e}-${l.getGeoviewLayerId()}`),c="true"===s.value?o.value:l.getLayerFilter(n);l.applyViewFilter(n,c,"true"!==s.value)})),t.appendChild(i);const s=document.createElement("br");s.style.height="1px",t.appendChild(s)}for(let s=0;s<d.style[a].classBreakStyleInfo.length;s++){const o=document.createElement("button");!0===d.style[a].classBreakStyleInfo[s].visible?o.innerText=`Hide ${d.style[a].classBreakStyleInfo[s].label}`:!1===d.style[a].classBreakStyleInfo[s].visible&&(o.innerText=`Show ${d.style[a].classBreakStyleInfo[s].label}`),o.addEventListener("click",(t=>{const i=d.style[a].classBreakStyleInfo[s];!0===i.visible?(i.visible=!1,o.innerText=`Show ${i.label}`):!1===i.visible&&(i.visible=!0,o.innerText=`Hide ${i.label}`);const c=document.getElementById(`checkbox-${e}-${l.getGeoviewLayerId()}`),r=document.getElementById(`filter-input-${e}-${l.getGeoviewLayerId()}`),u="true"===c.value?r.value:l.getLayerFilter(n);l.applyViewFilter(n,u,"true"!==c.value)})),t.appendChild(o),t.appendChild(i[a].arrayOfCanvas[s]);const c=document.createElement("br");c.style.height="1px",t.appendChild(c)}}const o=document.createElement("p");o.innerText="Extra filter: ",t.appendChild(o);const c=document.createElement("input");c.id=`filter-input-${e}-${l.getGeoviewLayerId()}`,c.style.width="50%",o.appendChild(c),c.value=l.getLayerFilter(n)||"";const r=document.createElement("button");r.addEventListener("click",(t=>{const a=document.getElementById(`checkbox-${e}-${l.getGeoviewLayerId()}`);l.applyViewFilter(n,c.value,"true"!==a.value)})),r.innerText="Apply",o.style.width="max-content",o.appendChild(r);const u=document.createElement("input");u.type="checkbox",u.value="false",u.id=`checkbox-${e}-${l.getGeoviewLayerId()}`,u.addEventListener("click",(e=>{u.value="true"===u.value?"false":"true",l.applyViewFilter(n,c.value,"true"!==u.value)})),t.appendChild(u);const y=document.createElement("label");y.innerText="apply only the extra filter",t.appendChild(y)}))}))}}))}))};function displayLegend(e,t){const l=(e,t)=>{const l=document.createElement("th");l.style="text-align: center; vertical-align: middle;",l.innerHTML=e,t.appendChild(l)},a=(e,t)=>{const l=document.createElement("td");l.style.verticalAlign="middle",l.style.textAlign="center",e?"string"==typeof e?l.innerHTML=e.replaceAll("<","&lt;").replaceAll(">","&gt;"):l.appendChild(e):l.innerHTML="NO LEGEND",t.appendChild(l)},n=document.getElementById(`${e}-table`);n&&n.parentNode.removeChild(n);const d=document.getElementById(`${e}-table-pre`),i=document.createElement("table");i.id=`${e}-table`,i.border="1",i.style="width:50%",d.appendChild(i);let s=!0;Object.keys(t).forEach((e=>{const n=t[e];if(s){s=!1;const e=document.createElement("tr");i.appendChild(e),l("Layer Path",e),l("Status/Label",e),l("Symbology",e)}if(n?.data?.legend)if("ogcWms"===n.data?.type||"imageStatic"===n.data?.type){const e=document.createElement("tr");a(n.data.layerPath,e),a(n.layerStatus,e),a(n.data.legend,e),i.appendChild(e)}else{const t=(e,t,l)=>{const n=document.createElement("tr");a(e,n),a(t,n),a(l,n),i.appendChild(n)};n.data?.legend&&Object.keys(n.data.legend).forEach((l=>{if(l)if("uniqueValue"===n.data.styleConfig[l].styleType){n.data.legend[l].defaultCanvas&&t(e,n.data.styleConfig[l].defaultLabel,n.data.legend[l].defaultCanvas);for(let a=0;a<n.data.legend[l].arrayOfCanvas.length;a++)t(e,n.data.styleConfig[l].uniqueValueStyleInfo[a].label,n.data.legend[l].arrayOfCanvas[a])}else if("classBreaks"===n.data.styleConfig[l].styleType){n.data.legend[l].defaultCanvas&&t(e,n.data.styleConfig[l].defaultLabel,n.data.legend[l].defaultCanvas);for(let a=0;a<n.data.legend[l].arrayOfCanvas.length;a++)t(e,n.data.styleConfig[l].classBreakStyleInfo[a].label,n.data.legend[l].arrayOfCanvas[a])}else"simple"===n.data.styleConfig[l].styleType&&t(e,n.data.styleConfig[l].label,n.data.legend[l].defaultCanvas)}))}else{const t=document.createElement("tr");a(e,t);let l="";void 0===n.data&&(l="(waiting for legend)"),null===n.data&&(l="(legend fetch error)"),n.data&&!n.data.legend&&"loaded"===n.layerStatus&&(l="(no legend)"),a(n.layerStatus,t),a(l,t),i.appendChild(t)}}))}