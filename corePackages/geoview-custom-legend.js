/*! Package:geoview-custom-legend: 2.0.2 - "a331a5945a13ab17a82b43f298a7fb8a7771478d" - 2025-10-27T15:00:38.789Z */
"use strict";(self.webpackChunkgeoview_core=self.webpackChunkgeoview_core||[]).push([[303],{37390:e=>{e.exports=JSON.parse('{"type":"object","properties":{"id":{"type":"string"},"enabled":{"type":"boolean"},"isOpen":{"type":"boolean"},"legendList":{"type":"array","items":{"type":"object","properties":{"legendTitle":{"type":"string"},"iconUrl":{"type":"string"},"layerId":{"type":"string"},"visibility":{"type":"boolean"}},"required":["legendTitle","layerId"]}},"version":{"type":"string"}},"required":["id","legendList"]}')},45314:(e,t,n)=>{n.a(e,async(e,t)=>{try{var r=n(64477),i=n(43549),o=n(51310),l=n(54074),a=n(98615),s=n(75509),c=n(10379),u=n(30538),d=n(49260),p=n(8889),f=n(78967),g=n(37390),m=n(74069),h=n(97282),y=e([d,f]);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach(function(t){(0,c.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function j(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(j=function(){return!!e})()}[d,f]=y.then?(await y)():y;var v=function(e){function t(){var e,n,i,a;(0,r.A)(this,t);for(var s=arguments.length,u=new Array(s),d=0;d<s;d++)u[d]=arguments[d];return n=this,i=t,a=[].concat(u),i=(0,l.A)(i),e=(0,o.A)(n,j()?Reflect.construct(i,a||[],(0,l.A)(n).constructor):i.apply(n,a)),(0,c.A)(e,"onCreateContent",function(){return(0,h.jsx)(f.J,{config:e.getConfig(),onUpdateLegend:function(t){var n=e.getConfig();e.setConfig(b(b({},n),{},{legendList:t}))}})}),e}return(0,s.A)(t,e),(0,i.A)(t,[{key:"schema",value:function(){return g}},{key:"defaultConfig",value:function(){return m}},{key:"defaultTranslations",value:function(){return{en:{CustomLegend:{title:"Custom Legend"}},fr:{CustomLegend:{title:"Légende personnalisée"}}}}},{key:"getConfig",value:function(){return(e=t,n="getConfig",r=this,i=3,o=(0,a.A)((0,l.A)(1&i?e.prototype:e),n,r),2&i&&"function"==typeof o?function(e){return o.apply(r,e)}:o)([]);var e,n,r,i,o}},{key:"onCreateButtonProps",value:function(){return{id:"custom-legend",tooltip:"CustomLegend.title",tooltipPlacement:"right",children:(0,h.jsx)(p.h8,{}),visible:!0}}},{key:"onCreateContentProps",value:function(){return{title:"CustomLegend.title",icon:(0,h.jsx)(p.h8,{}),width:350,status:this.getConfig().isOpen}}},{key:"onRemoved",value:function(){}}])}(d.i);u===window.cgpv.reactUtilities.react&&(window.geoviewPlugins=window.geoviewPlugins||{},window.geoviewPlugins["custom-legend"]=v),t()}catch(w){t(w)}})},49260:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{i:()=>f});var i=n(64477),o=n(43549),l=n(51310),a=n(54074),s=n(98615),c=n(75509),u=n(10379),d=n(82330),p=e([d]);function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!e})()}var f=function(e){function t(){var e,n,r,o;(0,i.A)(this,t);for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];return n=this,r=t,o=[].concat(c),r=(0,a.A)(r),e=(0,l.A)(n,g()?Reflect.construct(r,o||[],(0,a.A)(n).constructor):r.apply(n,o)),(0,u.A)(e,"buttonPanel",void 0),(0,u.A)(e,"buttonProps",void 0),(0,u.A)(e,"panelProps",void 0),e}return(0,c.A)(t,e),(0,o.A)(t,[{key:"getConfig",value:function(){return(e=t,n="getConfig",r=this,i=3,o=(0,s.A)((0,a.A)(1&i?e.prototype:e),n,r),2&i&&"function"==typeof o?function(e){return o.apply(r,e)}:o)([]);var e,n,r,i,o}},{key:"onCreateButtonProps",value:function(){var e=window.cgpv.ui.elements.MapIcon;return{id:"somePluginButton",tooltip:"Some tooltip",tooltipPlacement:"right",children:this.react.createElement(e),visible:!0}}},{key:"onCreateContentProps",value:function(){return{title:"Some title",icon:'<i class="material-icons">map</i>',width:"80vw",status:this.getConfig().isOpen}}},{key:"onCreateContent",value:function(){return this.react.createElement("div",void 0,"Content for AppBar Plugin on map id ".concat(this.mapViewer.mapId," goes here..."))}},{key:"onAdd",value:function(){this.buttonProps=this.onCreateButtonProps(),this.panelProps=this.onCreateContentProps(),this.panelProps.content=this.onCreateContent(),this.buttonPanel=this.mapViewer.appBarApi.createAppbarPanel(this.buttonProps,this.panelProps)||void 0}},{key:"onRemove",value:function(){this.buttonPanel&&this.mapViewer.appBarApi.removeAppbarPanel(this.buttonPanel.buttonPanelId)}}])}((d=(p.then?(await p)():p)[0]).G);r()}catch(m){r(m)}})},74069:e=>{e.exports=JSON.parse('{"id":"custom-legend","enabled":true,"isOpen":false,"legendList":[],"version":"1.0"}')},78967:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{J:()=>w});var i=n(76092),o=n(10379),l=n(80171),a=n(55940),s=n(6416),c=n(50124),u=n.n(c),d=n(30538),p=n(16131),f=n(93661),g=n(97282),m=e([p]),h=m.then?(await m)():m;function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){(0,o.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}p=h[0];var y=function(e){var t=e.className,n=void 0===t?"":t,r=e.fontSize,i=void 0===r?"medium":r;return(0,g.jsx)("i",{className:"material-icons ".concat(n),style:{fontSize:i},children:"Edit"})},v=function(e){var t=e.className,n=void 0===t?"":t,r=e.fontSize,i=void 0===r?"medium":r;return(0,g.jsx)("i",{className:"material-icons ".concat(n),style:{fontSize:i},children:"delete"})},x=function(e){var t=e.className,n=void 0===t?"":t,r=e.fontSize,i=void 0===r?"medium":r;return(0,g.jsx)("i",{className:"material-icons ".concat(n),style:{fontSize:i},children:"save"})};function w(e){var t=e.config,n=e.onUpdateLegend,r=t.legendList,c=d.useState(null),m=(0,s.A)(c,2),h=m[0],b=m[1],w=d.useState(null),C=(0,s.A)(w,2),A=C[0],P=C[1],O=d.useState(!1),S=(0,s.A)(O,2),k=S[0],U=S[1],L=window.cgpv.ui,T=L.elements,N=T.Card,z=T.Box,E=T.Button,I=T.TextField,D=T.IconButton,B=T.Dialog,R=T.DialogTitle,F=T.DialogContent,J=T.DialogActions,W=T.Typography,H=L.useTheme(),V=(0,f.S)(H),q=d.useRef(null),M=d.useState(""),_=(0,s.A)(M,2),G=_[0],Y=_[1],K=d.useState(!1),Q=(0,s.A)(K,2),X=Q[0],Z=Q[1],$=d.useState(""),ee=(0,s.A)($,2),te=ee[0],ne=ee[1],re=d.useState(""),ie=(0,s.A)(re,2),oe=ie[0],le=ie[1],ae=function(e){var t=null;Array.isArray(e)&&(e.every(function(e){return"object"===(0,a.A)(e)&&null!==e&&"legendTitle"in e&&("symbolUrl"in e&&"string"==typeof e.symbolUrl||"iconUrl"in e&&"string"==typeof e.iconUrl)&&"string"==typeof e.legendTitle&&(!("description"in e)||"string"==typeof e.description)})&&(t=e.map(function(e){return{legendTitle:e.legendTitle,symbolUrl:e.symbolUrl||e.iconUrl,description:e.description||""}})));if(!t&&e&&"object"===(0,a.A)(e)&&Array.isArray(e.symbologyStack)){var n=e.symbologyStack;n.every(function(e){return"object"===(0,a.A)(e)&&"string"==typeof e.image&&"string"==typeof e.text})&&(t=n.map(function(e){return{legendTitle:e.text,symbolUrl:e.image,description:""}}))}return t};d.useEffect(function(){var e=!1,t=function(){var t=(0,l.A)(u().mark(function t(r){var i,o,l,a,s,c,d;return u().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,Promise.allSettled(r.map(function(e){return fetch(e).then(function(t){return t.ok?t.json().then(function(t){return{path:e,data:t}}):Promise.reject()})}));case 1:i=t.sent,o=0;case 2:if(!(o<i.length)){t.next=4;break}if("fulfilled"!==(l=i[o]).status){t.next=3;break}if(a=l.value,s=a.path,c=a.data,!(d=ae(c))||e){t.next=3;break}return n&&n(d),Y(JSON.stringify(c,null,2)),U(!0),le(s),t.abrupt("return");case 3:o++,t.next=2;break;case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();return k||0!==r.length||t(["customlegend.json","/customlegend.json","./customlegend.json"]),function(){e=!0}},[k,r.length,n]);var se=function(e,t){A&&P(j(j({},A),{},(0,o.A)({},e,t)))};return(0,g.jsxs)(z,{sx:V.legendCard,children:[(0,g.jsxs)(z,{sx:{p:2,display:"flex",justifyContent:"space-between",gap:1,flexWrap:"wrap"},children:[(0,g.jsx)(z,{sx:{display:"flex",gap:1,mb:1},children:(0,g.jsxs)(E,{variant:"contained",component:"label",onClick:function(){var e;return null===(e=q.current)||void 0===e?void 0:e.click()},children:["Load Legend",(0,g.jsx)("input",{type:"file",ref:q,accept:".json",style:{display:"none"},onChange:function(e){var t,r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){var i=new FileReader;i.onload=function(e){try{var t,i=null===(t=e.target)||void 0===t?void 0:t.result,o=JSON.parse(i);Y(JSON.stringify(o,null,2));var l=ae(o);l?n&&(n(l),U(!0),le(r.name),q.current&&(q.current.value="")):p.vF.logError("Invalid legend data format")}catch(e){p.vF.logError("Error parsing legend file:",e)}},i.onerror=function(){p.vF.logError("Error reading file")},i.readAsText(r)}}})]})}),k&&r.length>0&&(0,g.jsxs)(z,{sx:{alignSelf:"center",color:"text.secondary"},children:[r.length," item",1!==r.length?"s":""," loaded"]})]}),r.length>0?(0,g.jsx)(z,{sx:{maxHeight:"400px",overflowY:"auto",pr:1},children:r.map(function(e,t){return(0,g.jsx)(N,{sx:{mb:2,position:"relative","&:hover .legend-actions":{opacity:1,visibility:"visible"}},children:(0,g.jsx)(z,{className:"legend-item-container",sx:{p:2},children:(0,g.jsxs)(z,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.symbolUrl&&(0,g.jsx)(z,{component:"img",src:e.symbolUrl,alt:"",sx:{width:40,height:40,objectFit:"contain",border:"1px solid #ddd",borderRadius:1}}),(0,g.jsxs)(z,{sx:{flex:1},children:[(0,g.jsx)(z,{sx:{fontWeight:"bold",mb:.5},children:e.legendTitle}),e.description&&(0,g.jsx)(z,{sx:{fontSize:"0.875rem",color:"text.secondary"},children:e.description})]}),(0,g.jsxs)(z,{className:"legend-actions",sx:{display:"flex",gap:1,opacity:0,visibility:"hidden",transition:"opacity 0.2s, visibility 0.2s"},children:[(0,g.jsx)(D,{size:"small",onClick:function(e){e.stopPropagation(),function(e){b(e),P(j({},r[e]))}(t)},title:"Edit",children:(0,g.jsx)(y,{fontSize:"small"})}),(0,g.jsx)(D,{size:"small",onClick:function(e){e.stopPropagation(),function(e){var t=r.filter(function(t,n){return n!==e});n&&n(t)}(t)},color:"error",title:"Delete",children:(0,g.jsx)(v,{fontSize:"small"})})]})]})})},"legend-item-".concat(e.legendTitle,"-").concat(e.symbolUrl))})}):(0,g.jsx)(z,{sx:{p:3,textAlign:"center",color:"text.secondary"},children:oe?"Loaded: ".concat(oe):"No legend items. Load a legend file or add a new item."}),(0,g.jsxs)(B,{open:null!==h&&null!==A,onClose:function(){b(null),P(null)},maxWidth:"sm",fullWidth:!0,children:[(0,g.jsx)(R,{children:null!==h&&h>=0?"Edit Legend Item":"Add New Legend Item"}),(0,g.jsx)(F,{children:(0,g.jsxs)(z,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[(0,g.jsx)(I,{label:"Legend Title",value:(null==A?void 0:A.legendTitle)||"",onChange:function(e){return se("legendTitle",e.target.value)},fullWidth:!0,margin:"dense"}),(0,g.jsx)(I,{label:"Symbol URL",value:(null==A?void 0:A.symbolUrl)||"",onChange:function(e){return se("symbolUrl",e.target.value)},fullWidth:!0,margin:"dense"}),(0,g.jsx)(I,{label:"Description",value:(null==A?void 0:A.description)||"",onChange:function(e){return se("description",e.target.value)},fullWidth:!0,multiline:!0,rows:2,margin:"dense"}),(null==A?void 0:A.symbolUrl)&&(0,g.jsxs)(z,{sx:{mt:1,textAlign:"center"},children:[(0,g.jsx)(z,{sx:{fontWeight:"medium",mb:1},children:"Preview:"}),(0,g.jsx)(z,{component:"img",src:A.symbolUrl,alt:"Symbol Preview",sx:{maxWidth:"100%",maxHeight:100,border:"1px solid #ddd",p:1,borderRadius:1}})]})]})}),(0,g.jsxs)(J,{children:[(0,g.jsx)(E,{onClick:function(){b(null),P(null)},children:"Cancel"}),(0,g.jsx)(E,{onClick:function(){if(null!==h&&A){var e=(0,i.A)(r);h>=0&&h<e.length?e[h]=A:e.push(A),n&&n(e),b(null),P(null)}},variant:"contained",color:"primary",startIcon:(0,g.jsx)(x,{}),children:"Save"})]})]}),G&&(0,g.jsxs)(z,{sx:{mt:3,p:2,borderTop:"1px solid #eee"},children:[(0,g.jsxs)(z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,g.jsx)(W,{variant:"h6",children:"JSON Content"}),X?(0,g.jsxs)(z,{sx:{display:"flex",gap:1},children:[(0,g.jsx)(E,{variant:"contained",color:"primary",size:"small",startIcon:(0,g.jsx)(x,{fontSize:"small"}),onClick:function(){try{var e=JSON.parse(te),t=ae(e);t?n&&(n(t),Y(JSON.stringify(e,null,2)),Z(!1)):p.vF.logError("Invalid JSON structure. Provide an array of items with legendTitle and symbolUrl/iconUrl, or an object with symbologyStack.")}catch(e){p.vF.logError(e instanceof Error?e.message:e)}}}),(0,g.jsx)(E,{variant:"outlined",size:"small",onClick:function(){Z(!1)},children:"Cancel"})]}):(0,g.jsx)(E,{variant:"outlined",size:"small",startIcon:(0,g.jsx)(y,{fontSize:"small"}),onClick:function(){ne(G),Z(!0)}})]}),X?(0,g.jsx)(I,{fullWidth:!0,multiline:!0,minRows:8,maxRows:12,value:te,onChange:function(e){ne(e.target.value)},variant:"outlined",sx:{fontFamily:"monospace",fontSize:"0.75rem","& .MuiInputBase-root":{p:1,bgcolor:"background.paper"}}}):(0,g.jsx)(z,{component:"pre",sx:{p:2,bgcolor:"background.paper",borderRadius:1,maxHeight:"200px",overflow:"auto",fontFamily:"monospace",whiteSpace:"pre-wrap",fontSize:"0.75rem",lineHeight:1.5},children:G})]})]})}r()}catch(C){r(C)}})},93661:(e,t,n)=>{n.d(t,{S:()=>r});var r=function(e){return{legendCard:{display:"flex",flexDirection:"column",gap:"8px",padding:"16px",backgroundColor:e.palette.background.paper,borderRadius:"4px",boxShadow:e.shadows[1]},legendIcon:{width:"24px",height:"24px",objectFit:"contain"}}}}},e=>{var t;t=45314,e(e.s=t)}]);
//# sourceMappingURL=geoview-custom-legend.js.map