function sleep(e){const t=Date.now();let n=null;do{n=Date.now()}while(n-t<e)}function createCodeSnippet(){sleep(500);const e=Array.prototype.filter.call(document.getElementsByTagName("script"),e=>null===e.getAttribute("id")),t=e[e.length-1];for(let e=0,n=!0;n;e++){const l=document.getElementById(`codeSnippet${e||""}`);null!==l?l.innerHTML=`<pre>${t.textContent.replace("//create snippets\n","").replace("createConfigSnippet();\n","").replace("createCodeSnippet();\n","")}</pre>`:n=!1}}function createCodeSnippetUsingIDs(){sleep(500);const e=Array.prototype.filter.call(document.getElementsByTagName("script"),e=>null!==e.getAttribute("id"));for(let t=0;t<e.length;t++){const n=e[t];document.querySelectorAll(`[id-script="${n.id}"]`).forEach(e=>{e.innerHTML=`<pre>${n.textContent}</pre>`})}}function createConfigSnippet(){sleep(500);let e=0;for(e=0;e<document.getElementsByClassName("geoview-map").length;e++){let t="";const n=document.getElementsByClassName("geoview-map")[e].id;t=document.getElementById(n).attributes["data-config"];const l=document.getElementById(`${n}CS`);try{if(void 0!==t&&null!==l){const e=t.value.split(/(?<!\\)'/gm).map((e,t)=>t%2?e.replaceAll(/\/\*/gm,String.fromCharCode(1)).replaceAll(/\*\//gm,String.fromCharCode(2)):e).join("'").replaceAll(/\/\*(?<=\/\*)((?:.|\n|\r)*?)(?=\*\/)\*\//gm,"").replaceAll(String.fromCharCode(1),"/*").replaceAll(String.fromCharCode(2),"*/");l.textContent=JSON.stringify(JSON.parse(e.replace(/(\r\n|\n|\r)/gm,"").replace(/(?<!\\)'/gm,'"').replace(/\\'/gm,"'")),void 0,2)}}catch(e){console.log("Error trapped in createConfigSnippet")}}createCollapsible()}function createCollapsible(){const e=document.getElementsByClassName("collapsible");let t;for(t=0;t<e.length;t++){const n=e[t].nextElementSibling;e[t].classList.contains("active")?n.style.display="block":n.style.display="none",e[t].addEventListener("click",function(){this.classList.toggle("active"),this.classList.contains("active")?n.style.display="block":n.style.display="none"})}}function addLog(e,t){const n=document.getElementById(e);n.innerText+=`${t}\n`,n.scrollTop=n.scrollHeight}function addDefaultShapes(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addCircle([-98.94,57.94],{style:{strokeColor:"purple",strokeWidth:2}}),e.layer.geometry.addMarkerIcon([-105.78,57.52]),e.layer.geometry.addPolyline([[-106.17,63.99],[-104.46,62.55],[-102.26,56.44]],{style:{strokeColor:"blue",strokeWidth:2}}),e.layer.geometry.addPolygon([[[-96.71,64.41],[-93.1,62.86],[-94.36,56.67],[-96.71,64.41]]],{style:{strokeColor:"green",strokeWidth:2}})}function addSpecialShapes(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addPolygon([[[-86.06,62.59],[-78.29,62.59],[-80.43,55.73],[-86.06,62.59]]],{style:{strokeColor:"red",strokeWidth:2}})}function addRectangle(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addPolygon([[[-100,60],[-100,70],[-70,70],[-70,60],[-100,60]]],{style:{strokeColor:"Indigo",strokeWidth:2,fillColor:"Indigo",fillOpacity:.25}},"rectangle-outline")}function listenToLegendLayerSetChanges(e,t){t.layer.legendsLayerSet.onLayerSetUpdated((t,n)=>{const{resultSet:l}=n,o='<table class="state"><tr class="state"><th class="state">Name</th><th class="state">Status</th></tr>',a=document.getElementById(e),r=Object.keys(l).reduce((e,t)=>{const n=l[t]?.layerName||"",{layerStatus:o}=l[t];return`${e}<tr class="state"><td class="state">${n}</td><td class="state">${o}</td></tr>`},o);a.innerHTML=r&&r!==o?`${r}</table>`:""})}async function onConfigChange(e,t){let n=document.getElementById(e);null===n&&(n=document.createElement("div"),n.setAttribute("id",e),document.getElementById("mapSection").appendChild(n)),n.setAttribute("data-lang",switchLang.value),cgpv.api.hasMapViewer(e)&&await cgpv.api.deleteMapViewer(e);try{listenToLegendLayerSetChanges("sandboxMap-state",await cgpv.api.createMapFromConfig(e,t.target.value,800))}catch(e){console.error("Failed to create map from config",e)}try{const e=await fetch(t.target.value),n=await e.json();document.getElementById("configGeoview").textContent=JSON.stringify(n,null,4);const l=document.querySelector("textarea"),o=document.querySelector(".line-numbers"),a=l.value.split("\n").length;o.innerHTML=Array(a).fill("<span></span>").join(""),document.getElementById("switchTheme").value=n.theme,document.getElementById("switchProjection").value=n.map.viewSettings.projection;const r=document.getElementById("configLoader");window.history.replaceState(null,null,`?config=${r.value}`)}catch(e){console.error("Unable to fetch data:",e)}}function cleanURL(e){const[t,n]=e.split("://"),l=n.indexOf("/"),o=-1===l?n:n.substring(0,l);let a=-1===l?"":n.substring(l);return a=a.replace(/\/+/g,"/"),a.length>1&&a.endsWith("/")&&(a=a.slice(0,-1)),`${t}://${o}${a}`}