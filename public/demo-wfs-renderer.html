<!doctype html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>WFS Renderer - Canadian Geospatial Platform Viewer</title><link rel="shortcut icon" href="./favicon.ico"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="msapplication-config" content="./img/browserconfig.xml"/><meta name="theme-color" content="#ffffff"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link rel="stylesheet" href="css/style.css"/><link rel="stylesheet" href="css/codemirror/codemirror.min.css"/><link rel="stylesheet" href="css/codemirror/liquibyte.css"/><script src="js/codemirror/codemirror.min.js"></script><script src="js/codemirror/perl.min.js"></script><script src="js/codemirror/xml.min.js"></script><style>label {
        font-size: 14px;
        font-style: italic;
      }

      #serviceUrlInput {
        width: 700px;
      }

      .CodeMirror {
        height: 700px; /* Height of the text area */
        width: 100%;           /* make CM fill its cell */
        box-sizing: border-box;
        max-width: 100%;
      }

      .CodeMirror textarea {
        width: 1px !important;
        min-width: 1px !important;
        max-width: 1px !important;
        height: 1em;
        position: absolute;
        overflow: hidden;
        resize: none;
      }</style><script src="cgpv-main.js"></script></head><body><div id="page-header"></div><div><div class="back-to-main"><a href="./index.html?tab=specific-demos">‚Üê Back to Main</a></div><div class="demo-section"><h4>WFS Renderer Style Configuration Demo</h4><p>This page is used to create a valid GeoView style config from a WMS service to use them for a WFS service.</p></div></div><div class="demo-section"><h4>Configuration Options</h4><div style="margin-bottom: 15px"><label for="renderer">Input WMS/WFS Renderer examples:</label> <select class="form-select" name="renderer" id="renderer" style="display: inline-block; width: auto; margin-left: 10px"><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/hc/airborne_radioactivity_en","layers":"AIRB_RAD"}'>Airborne (Point simple) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/critical_minerals_en","layers":"mines"}'>Mines (Point simple) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/oam_en","layers":"oam"}'>Abandoned Orphaned Mines (Point uniqueValue) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/earthquakes_en","layers":"earthquakes_2000-2010"}'>Earthquakes 2000-2010 (Point uniqueValue) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/iaac/assessment_inventory_en","layers":"completed"}'>Assessment Completed (Point uniqueValue) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/wind_turbine_database_en","layers":"QC"}'>Wind Turbine (Point uniqueValue (lots!)) - VPN</option><option value='{"url":"https://demo.mapserver.org/cgi-bin/wms","layers":"cities"}'>Cities (Point classBreaks)</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/charging_corridor_en","layers":"Corridor Public Charging Planning Map"}'>Charging Corridor (LineString uniqueValue) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/gsc_surficial_geology_en","layers":"DMF"}'>Surficial Geology (Polygon simple) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/lidar_point_cloud_canelevation_en","layers":"lidar-projects"}'>Lidar Point Cloud (Polygon simple) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/phys_reg_en","layers":"regions"}'>Regions (Polygon uniqueValue) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/GSC_Seismic_Reflection_en","layers":"pacific"}'>Pacific Seismic (LineString uniqueValue (complex, incomplete)) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/EGS_Flood_Archive_DEV_en","layers":"EGS_Flood_Extent_Archive_en"}'>EGS Flood Extent (Polygons with Lines rendering) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/major_projects_inventory_en","layers":"mpi-point"}'>Major Projects (styles with functions!) - VPN</option><option value='{"url":"https://qgis-stage.cdtk.geogc.ca/ows/nrcan/landcover_2010_15_20_en","layers":"landcover_2010_19classes"}'>Land Cover 2010-2019 Classes (no GetStyles at all) - VPN</option></select></div></div><div class="demo-section"><span>WMS associated with the WFS to read the styles from</span> <input id="stylesUrl" style="width:100%;"/><br/><span>The layers</span> <input id="layers" style="width:100%;"/><div><button class="btn btn-primary" id="executeFetch" style="margin: 10px 0px;">Fetch XML</button></div><h4>The GetStyles response from the WMS which will be used to create the Geoview style:</h4><textarea id="inputTextArea"></textarea><div><button class="btn btn-primary" id="executeButton" style="margin: 10px 0px;">Execute</button></div><h4>Geoview Output Style Configuration:</h4><textarea id="outputTextArea"></textarea><div><p>The resulting configuration can be used to set a layer's "layerStyle" property.<br><i>Example:</i><pre>
                <code>
'listOfGeoviewLayerConfig': [{
  'geoviewLayerId': 'M6QU5DFK9PY3U',
  "metadataAccessPath": "https://qgis-stage.cdtk.geogc.ca/ows/nrcan/GSC_Seismic_Reflection_en",
  "geoviewLayerType": "ogcWfs",
  "listOfLayerEntryConfig": [{
    "layerId": pacific,
    "layerStyle": {<strong>OUTPUT STYLE CONFIG HERE</strong>}
  }]
}]
                </code>
              </pre></p></div></div><script src="codedoc.js"></script><script>insertPageHeader();

      // The elements
      const rendererDropdown = document.getElementById('renderer');
      const executeFetch = document.getElementById('executeFetch');
      const executeButton = document.getElementById('executeButton');
      const intputTextArea = document.getElementById('inputTextArea');
      const outputTextArea = document.getElementById('outputTextArea');
      const txtWMSUrl = document.getElementById('stylesUrl');
      const txtLayers = document.getElementById('layers');

      // Transform the text area into a code text area using CodeMirror
      const editorInputProcess = CodeMirror.fromTextArea(intputTextArea, {
          lineNumbers: true,
          mode: 'xml',
          theme: 'liquibyte',
          lineWrapping: true,
          matchTags: true,
          autoCloseTags: true,
      });

      // Transform the text area into a code text area using CodeMirror
      const editorOutputProcess = CodeMirror.fromTextArea(outputTextArea, {
          lineNumbers: true,
          mode: 'text/x-perl',
          theme: 'liquibyte',
          lineWrapping: true,
          matchTags: true,
          autoCloseTags: true,
      });

      function updateUI() {
        const value = JSON.parse(rendererDropdown.value);
        txtWMSUrl.value = value.url;
        txtLayers.value = value.layers;
      }
      updateUI();

      async function fetchWMSStyles() {
        try {
          editorInputProcess.setValue('');
          editorOutputProcess.setValue('');
          const result = await cgpv.api.config.fetchStyleFromWMS(txtWMSUrl.value, txtLayers.value);
          editorInputProcess.setValue(result);

          // Wait before parsing the SLD - just for the UI to refresh
          await cgpv.api.utilities.core.delay(500);

          // Parse it right away
          parseOutputStyles();
        } catch (error) {
          alert(error);
        }
      };
      fetchWMSStyles();

      function parseOutputStyles() {
        const geoViewRenderer = cgpv.api.config.getStyleFromWMSRenderer(editorInputProcess.getValue());
        editorOutputProcess.setValue(JSON.stringify(geoViewRenderer, undefined, 2));
      }

      rendererDropdown.addEventListener('change', (e) => {
        updateUI();
        fetchWMSStyles();
      });

      executeFetch.addEventListener('click', (e) => {
        // Go
        fetchWMSStyles();
      });

      executeButton.addEventListener('click', (e) => {
        parseOutputStyles();
      });</script></body></html>