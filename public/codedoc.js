function sleep(e){const t=Date.now();let n=null;do{n=Date.now()}while(n-t<e)}function createCodeSnippet(){sleep(500);const e=Array.prototype.filter.call(document.getElementsByTagName("script"),e=>null===e.getAttribute("id")),t=e[e.length-1];for(let e=0,n=!0;n;e++){const s=document.getElementById(`codeSnippet${e||""}`);null!==s?s.innerHTML=`<pre>${t.textContent.replace("//create snippets\n","").replace("createConfigSnippet();\n","").replace("createCodeSnippet();\n","")}</pre>`:n=!1}}function createCodeSnippetUsingIDs(){sleep(500);const e=Array.prototype.filter.call(document.getElementsByTagName("script"),e=>null!==e.getAttribute("id"));for(let t=0;t<e.length;t++){const n=e[t];document.querySelectorAll(`[id-script="${n.id}"]`).forEach(e=>{e.innerHTML=`<pre>${n.textContent}</pre>`})}}function createConfigSnippet(){sleep(500);let e=0;for(e=0;e<document.getElementsByClassName("geoview-map").length;e++){let t="";const n=document.getElementsByClassName("geoview-map")[e].id;t=document.getElementById(n).attributes["data-config"];const s=document.getElementById(`${n}CS`);try{if(void 0!==t&&null!==s){const e=t.value.split(/(?<!\\)'/gm).map((e,t)=>t%2?e.replaceAll(/\/\*/gm,String.fromCharCode(1)).replaceAll(/\*\//gm,String.fromCharCode(2)):e).join("'").replaceAll(/\/\*(?<=\/\*)((?:.|\n|\r)*?)(?=\*\/)\*\//gm,"").replaceAll(String.fromCharCode(1),"/*").replaceAll(String.fromCharCode(2),"*/");s.textContent=JSON.stringify(JSON.parse(e.replace(/(\r\n|\n|\r)/gm,"").replace(/(?<!\\)'/gm,'"').replace(/\\'/gm,"'")),void 0,2)}}catch(e){console.log("Error trapped in createConfigSnippet")}}createCollapsible()}function createCollapsible(){const e=document.getElementsByClassName("collapsible");let t;for(t=0;t<e.length;t++){const n=e[t].nextElementSibling;e[t].classList.contains("active")?n.style.display="block":n.style.display="none",e[t].addEventListener("click",function(){this.classList.toggle("active"),this.classList.contains("active")?n.style.display="block":n.style.display="none"})}}function addLog(e,t){const n=document.getElementById(e);n.innerText+=`${t}\n`,n.scrollTop=n.scrollHeight}function addDefaultShapes(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addCircle([-98.94,57.94],{style:{strokeColor:"purple",strokeWidth:2}}),e.layer.geometry.addMarkerIcon([-105.78,57.52]),e.layer.geometry.addPolyline([[-106.17,63.99],[-104.46,62.55],[-102.26,56.44]],{style:{strokeColor:"blue",strokeWidth:2}}),e.layer.geometry.addPolygon([[[-96.71,64.41],[-93.1,62.86],[-94.36,56.67],[-96.71,64.41]]],{style:{strokeColor:"green",strokeWidth:2}})}function addSpecialShapes(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addPolygon([[[-86.06,62.59],[-78.29,62.59],[-80.43,55.73],[-86.06,62.59]]],{style:{strokeColor:"red",strokeWidth:2}})}function addRectangle(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addPolygon([[[-100,60],[-100,70],[-70,70],[-70,60],[-100,60]]],{style:{strokeColor:"Indigo",strokeWidth:2,fillColor:"Indigo",fillOpacity:.25}},"rectangle-outline")}function listenToLegendLayerSetChanges(e,t){t.layer.legendsLayerSet.onLayerSetUpdated((t,n)=>{const{resultSet:s}=n,l='<table class="state"><tr class="state"><th class="state">Name</th><th class="state">Status</th></tr>',o=document.getElementById(e),a=Object.keys(s).reduce((e,t)=>{const n=s[t]?.layerName||"",{layerStatus:l}=s[t];return`${e}<tr class="state"><td class="state">${n}</td><td class="state">${l}</td></tr>`},l);o.innerHTML=a&&a!==l?`${a}</table>`:""})}async function onConfigChange(e,t){let n=document.getElementById(e);null===n&&(n=document.createElement("div"),n.setAttribute("id",e),document.getElementById("mapSection").appendChild(n)),n.setAttribute("data-lang",switchLang.value),cgpv.api.hasMapViewer(e)&&await cgpv.api.deleteMapViewer(e);try{listenToLegendLayerSetChanges("sandboxMap-state",await cgpv.api.createMapFromConfig(e,t.target.value,800))}catch(e){console.error("Failed to create map from config",e)}try{const e=await fetch(t.target.value),n=await e.json();document.getElementById("configGeoview").textContent=JSON.stringify(n,null,4);const s=document.querySelector("textarea"),l=document.querySelector(".line-numbers"),o=s.value.split("\n").length;l.innerHTML=Array(o).fill("<span></span>").join(""),document.getElementById("switchTheme").value=n.theme,document.getElementById("switchProjection").value=n.map.viewSettings.projection;const a=document.getElementById("configLoader");window.history.replaceState(null,null,`?config=${a.value}`)}catch(e){console.error("Unable to fetch data:",e)}}function cleanURL(e){const[t,n]=e.split("://"),s=n.indexOf("/"),l=-1===s?n:n.substring(0,s);let o=-1===s?"":n.substring(s);return o=o.replace(/\/+/g,"/"),o.length>1&&o.endsWith("/")&&(o=o.slice(0,-1)),`${t}://${l}${o}`}function testSuiteCreateTable(e){const t=e.mapViewer.mapId,n=e.getDescriptionAsHtml(),s=document.createElement("div");return s.innerHTML=`\n    <div style="white-space: pre-line;">${n}</div>\n    <div style="text-align:right;">\n      <span id="suitesCheck-${t}"></span>\n    </div>\n    <div style="text-align:right;">\n      Suites: <span id="suitesCompleted-${t}">0</span>/<span id="suitesTotal-${t}">0</span>\n    </div>\n    <div style="text-align:right;">\n      Running: <span id="testsRunning-${t}">0</span> | Done success: <span id="testsDoneSuccess-${t}" style="color:green;">0</span> | Done failed: <span id="testsDoneFailed-${t}" style="color:green;">0</span> | Done: <span id="testsDone-${t}">0</span>/<span id="testsTotal-${t}">0</span>\n    </div>\n    <button class="btnLaunchTests" onclick="launchTests('${t}')">LAUNCH TESTS ${t} !</button>\n    <br/><br/>\n    <table id="tableResults-${t}" class="tableResults">\n      <colgroup>\n        <col>\n        <col style="width: 80px;">\n        <col>\n      </colgroup>\n      <thead>\n        <tr><td>TEST</td><td>RESULT</td><td>DETAILS</td></tr>\n      </thead>\n      <tbody id="tableBody-${t}"></tbody>\n    </table>\n  `,s}function testSuiteUpdateTotals(e,t=""){const n=t?t+"-":"",s=document.getElementById(n+"suitesCompleted-"+e.mapViewer.mapId);s&&(s.textContent=e.getSuitesCompleted());const l=document.getElementById(n+"suitesTotal-"+e.mapViewer.mapId);l&&(l.textContent=e.getSuitesTotal());const o=document.getElementById(n+"suitesCheck-"+e.mapViewer.mapId);if(o){const t=e.getTestsRunning()>0,n=e.getTestsDoneAllAndSuiteDone(),s=e.getTestsDoneAllSuccessAndSuiteDone();o.textContent=n?s?"✔":"✘":t?"⏳":"",o.style.color=n?s?"green":"red":"black"}const a=document.getElementById(n+"testsRunning-"+e.mapViewer.mapId);a&&(a.textContent=e.getTestsRunning());const i=document.getElementById(n+"testsDoneSuccess-"+e.mapViewer.mapId);i&&(i.textContent=e.getTestsDoneSuccess());const c=document.getElementById(n+"testsDoneFailed-"+e.mapViewer.mapId);c&&(c.textContent=e.getTestsDoneFailed(),c.style.color="green",e.getTestsDoneFailed()>0&&(c.style.color="red"));const d=document.getElementById(n+"testsDone-"+e.mapViewer.mapId);d&&(d.textContent=e.getTestsDone());const r=document.getElementById(n+"testsTotal-"+e.mapViewer.mapId);r&&(r.textContent=e.getTestsTotal())}function testSuiteUpdateGrandTotal(e){let t=0,n=0,s=0,l=0,o=0,a=0,i=0;const c=Object.values(e);c.forEach(e=>{t+=e.getSuitesCompleted(),n+=e.getSuitesTotal(),s+=e.getTestsRunning(),l+=e.getTestsDoneSuccess(),o+=e.getTestsDoneFailed(),a+=e.getTestsDone(),i+=e.getTestsTotal()});document.getElementById("allSuitesCompleted").textContent=t;document.getElementById("allSuitesTotal").textContent=n;const d=document.getElementById("allSuitesCheck"),r=s>0,g=c.every(e=>e.getTestsDoneAllAndSuiteDone()),p=c.every(e=>e.getTestsDoneAllSuccessAndSuiteDone());d.textContent=g?p?"✔":"✘":r?"⏳":"",d.style.color=g?p?"green":"red":"black";document.getElementById("allSuitesTestsRunning").textContent=s;document.getElementById("allSuitesTestsDoneSuccess").textContent=l;document.getElementById("allSuitesTestsDoneFailed").textContent=o;document.getElementById("allSuitesTestsDone").textContent=a;document.getElementById("allSuitesTestsTotal").textContent=i}function testSuiteAddOrUpdateTestResultRow(e,t,n,s,l,o=""){let a=null;"success"===s.getStatus()?a=!0:"failed"===s.getStatus()&&(a=!1);const i=o?o+"-":"",c=document.getElementById(i+"tableBody-"+e.mapViewer.mapId);if(!c)return;let d=document.getElementById(i+s.id);d||(d=document.createElement("tr"),d.id=i+s.id,d.classList.add("expanded"),d.appendChild(document.createElement("td")),d.appendChild(document.createElement("td")),d.appendChild(document.createElement("td")),c.appendChild(d));const r=d.cells?.[0];let g="#515ba5";"true-negative"===s.getType()&&(g="#6e78c5");let p='<font class="test-title" style="color:'+g+";\" onclick=\"event.stopPropagation(); this.closest('tr').classList.toggle('expanded'); this.closest('tr').classList.toggle('collapsed');\">"+s.getTitle()+"</font><br/>";p+='<div class="collapsible-content" style="margin-top: 5px;">',p+='<font style="font-size: x-small;"><i>['+t.getName()+" | "+n.getName()+"]</i></font>",p+=s.getStepsAsHtml(),r.innerHTML=p;const m=d.cells?.[1],u=d.cells?.[2];m&&(m.style.textAlign="center",!0===a?(d.classList.add("collapsed"),d.classList.remove("expanded"),m.style.color="green",m.textContent="✔"):!1===a?(d.classList.add("expanded"),d.classList.remove("collapsed"),m.style.color="red",m.textContent="✘",u.textContent=l,u.style.whiteSpace="pre-line"):(m.style.color="black",m.textContent="⏳")),p+="</div>"}function testSuiteEmptyTestResults(e){const t=document.getElementById("tableBody-"+e.mapViewer.mapId);for(;t.firstChild;)t.removeChild(t.firstChild)}function insertPageHeader(){const e=document.getElementById("page-header");e&&(e.innerHTML='\n    <div class="page-header">\n      <img class="header-logo" alt="logo" src="./img/Logo.png" />\n      <div class="page-header-titles">\n        <h1 class="index-header-title"><strong>Plateforme Géospatiale Canadienne (PGC) - Projet GeoView -</strong></h1>\n        <h1 class="index-header-title"><strong>Canadian Geospatial Platform (CGP) - GeoView Project -</strong></h1>\n      </div>\n    </div>\n    <div style="border-bottom: 3px solid #515ba5; margin: 20px 0;"></div>\n  ')}