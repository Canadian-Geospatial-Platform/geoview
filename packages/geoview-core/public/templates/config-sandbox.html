<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sandbox Configuration - Canadian Geospatial Platform Viewer</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="msapplication-config" content="./img/browserconfig.xml" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="css/style.css" />

    <style>
      .tab-container {
          width: 100%;
          margin: 0 auto;
      }

      .tabs {
          display: flex;
          border-bottom: 1px solid #ccc;
      }

      .tab-link {
          background-color: #f1f1f1;
          border: 1px solid #ccc;
          border-bottom: none;
          outline: none;
          cursor: pointer;
          padding: 8px 10px;
          transition: background-color 0.3s;
          flex: none;
          text-align: center;
      }

      .tab-link:hover {
          background-color: #ddd;
      }

      .tab-link.active {
          background-color: #ccc;
      }

      .tab-content {
          padding: 16px;
          border: 1px solid #ccc;
          border-top: none;
      }

      .editor {
        display: inline-flex;
        gap: 10px;
        font-family: monospace;
        line-height: 21px;
        background: #282a3a;
        border-radius: 2px;
        padding: 20px 10px;
        height: 500px;
        overflow-y: auto;
      }

      .line-numbers {
        width: 20px;
        text-align: right;
        height: 9999px;
      }

      .line-numbers span {
        counter-increment: linenumber;
      }

      .line-numbers span::before {
        content: counter(linenumber);
        display: block;
        color: #506882;
      }

    textarea {
      height: 99999px;
      line-height: 21px;
      overflow-y: hidden;
      padding: 0;
      border: 0;
      background: #282a3a;
      color: #fff;
      min-width: 500px;
      outline: none;
      resize: none;
      overflow-x: auto;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <div class="header-table">
    <table>
      <tbody>
        <tr>
          <td><img class="header-logo" alt="logo" src="./img/Logo.png" /></td>
          <td class="header-title">
            <h1><strong>Sandbox Configuration</strong></h1>
          </td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr>
          <td><a href="./index.html">Main</a><br /></td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr>
          <td>This page is used to test map configuration.</td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr>
          <td>
            <span>Input Configuration</span>
            <div class="editor">
              <div class="line-numbers" id="inputLineNumbers">
                <span></span>
              </div>
              <textarea id="configGeoview" name="configuration" cols="110">
              </textarea>
            </div>
          </td>
          <td>
            <span>Internal configuration:</span>
            <span id="validationMessage" >File not validated...</span>
            <div class="editor">
              <div class="line-numbers" id="outputLineNumbers">
                <span></span>
              </div>
              <textarea id="configOutput" name="configuration" cols="110">
              </textarea>
            </div>
            <div>
              Element Displayed:
              <select name="Element Selector" id="elementSelector">
              </select>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="tab-container">
    <div class="tabs">
      <button class="tab-link active" onclick="openTab(event, 'tab1')">Map Config</button>
      <button class="tab-link" onclick="openTab(event, 'tab2')">GeoView Config</button>
      <button class="tab-link" onclick="openTab(event, 'tab3')">URL Config</button>
      <button class="tab-link" onclick="openTab(event, 'tab4')">Metadata Layer Tree</button>
    </div>

    <div id="tab1" class="tab-content">
      <div>
        <p>This section lets you select and edit a complete map configuration.<br />
        The button calls the <b>ConfigApi.createMapConfig</b> method and displays the internal map configuration.</p>
        <div>
          Configuration to load:
          <select name="Config Loader" id="configLoader">
            <option value="">--select--</option>
            <option value="./configs/validator/01-simple.json">Simple</option>
            <option value="./configs/validator/02-unique-value.json">Unique Value</option>
            <option value="./configs/validator/03-class-breaks.json">Class Breaks</option>
            <option value="./configs/validator/04-geocore.json">Geocore</option>
            <option value="./configs/validator/05-metadata-group.json">Metadata Group</option>
          </select>
        </div>
      </div>
      <div>
        <select id="language1">
          <option value="en">English</option>
          <option value="fr">Français</option>
        </select>
        <button id="validateConfig" style="margin-top:10px;">Create Map Config</button>
        <button id="createMap" style="margin:10px;">Create Map</button>
        <button id="deleteMap" style="margin:10px;">Delete map</button>
      </div>
    </div>
    <div id="tab2" class="tab-content" style="display:none">
      <div>
        <p>This section lets you enter and edit a GeoView service URL or a GeoCore identifier.<br />
          If the GeoView layer type selected is wrong or unknown, you can select the right value using the drop down. <br />
          The button calls the <b>ConfigApi.createLayerConfig</b> method and displays the resulting internal map configuration.
        </p>
        GeoView Layer Type:
        <select name="Layer Type" id="geoviewLayerType">
          <option value="unknown">unknown</option>
          <option value="esriDynamic">EsriDynamic</option>
          <option value="esriFeature">EsriFeature</option>
          <option value="geoCore">GeoCore</option>
        </select>
      </div>
      <input type="text" id="serviceUrlGeoview" name="ServiceUrlconfiguration" style="width: 100%;" />
      <div>
        <select id="language2">
          <option value="en">English</option>
          <option value="fr">Français</option>
        </select>
        <button id="validateServiceUrlConfig" style="margin-top:10px;">Create Layer Config</button>
        <p></p>
        Sample URL:
        <select name="Sample Selector" id="sampleUrlSelector">
          <option value="">--select--</option>
          <option value="esriDynamic">EsriDynamic</option>
          <option value="esriFeature">EsriFeature</option>
          <option value="geoCore">GeoCore</option>
        </select>
      </div>
    </div>
    <div id="tab3" class="tab-content" style="display:none">
      <p>This section allows you to enter a string of parameters that would be written at the end of a GeoView URL.<br />
        The button calls the <b>ConfigApi.getConfigFromUrl</b> method and displays the resulting internal map configuration.</p>
      <span>Parameters following the service URL:</span>
      <br />
      <input type="text" id="configUrlGeoview" name="Urlconfiguration" style="width: 100%;"
             value="p=3857&z=4&c=-100,40&l=en&t=dark&b=basemapId:transport,shaded:false,labeled:true&i=dynamic&cc=overview-map&keys=12acd145-626a-49eb-b850-0a59c9bc7506,ccc75c12-5acc-4a6a-959f-ef6f621147b9">
      </input>
      <div>
        <button id="validateUrlConfig" style="margin-top:10px;">Get Config From URL</button>
      </div>
    </div>
    <div id="tab4" class="tab-content" style="display:none">
      <div>
        <p>This section lets you enter and edit a GeoView service URL or a GeoCore identifier.<br />
          If the GeoView layer type selected is wrong or unknown, you can select the right value using the drop down. <br />
          The button calls the <b>ConfigApi.createMetadataLayerTree</b> method and displays the resulting layer tree.
        </p>
        GeoView Layer Type:
        <select name="Layer Type" id="geoviewLayerType2">
          <option value="unknown">unknown</option>
          <option value="esriDynamic">EsriDynamic</option>
          <option value="esriFeature">EsriFeature</option>
          <option value="geoCore">GeoCore</option>
        </select>
      </div>
      <input type="text" id="serviceUrlGeoview2" name="ServiceUrlconfiguration" style="width: 100%;" />
      <div>
        <select id="language3">
          <option value="en">English</option>
          <option value="fr">Français</option>
        </select>
        <button id="validateServiceUrlConfig2" style="margin-top:10px;">Create Metadata Layer Tree</button>
        <p></p>
        Sample URL:
        <select name="Sample Selector" id="sampleUrlSelector2">
          <option value="">--select--</option>
          <option value="esriDynamic">EsriDynamic</option>
          <option value="esriFeature">EsriFeature</option>
          <option value="geoCore">GeoCore</option>
        </select>
      </div>
    </div>
  </div>
  <div class="map-title-holder">
    <h4 id="HLCONF1">Sanbox Map</h4>
    <a class="ref-link" href="#top">Top</a>
  </div>
  <div id="mapSection">
    <div id="sandboxMap"></div>
  </div>
  <p>This map loads it's configurations from the text area.</p>
  <hr />

  <button type="button" class="collapsible">Code Snippet</button>
  <pre id="codeSnippet" class="panel"></pre>

  <script src="codedoc.js"></script>

  <script>
    // Utility functions ========================================================================================================

    function openTab(evt, tabName) {
      var i, tabContent, tabLinks;

      // Hide all tab contents
      tabContent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabContent.length; i++) {
          tabContent[i].style.display = "none";
      }

      // Remove "active" class from all tab links
      tabLinks = document.getElementsByClassName("tab-link");
      for (i = 0; i < tabLinks.length; i++) {
          tabLinks[i].className = tabLinks[i].className.replace(" active", "");
      }

      // Mount the current tab content and add the "active" class to the current tab link
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
      switch (tabName) {
        case 'tab1':
          document.getElementById('configLoader').dispatchEvent(new Event('change'));
          break;
        case 'tab2':
          const sampleUrlSelector = document.getElementById('sampleUrlSelector');
          sampleUrlSelector.value = document.getElementById('geoviewLayerType').value;
          sampleUrlSelector.dispatchEvent(new Event('change'));
          break;
      }
    }

    // Element selector
    let mapConfigString, geoviewLayerString, metadataLayerTreeString, layerPathErrorFlag;
    const elementSelector = document.getElementById('elementSelector');
    const configOutput = document.getElementById('configOutput');
      elementSelector.addEventListener('change', (e) => {
        if (e.target.value === 'mapConfig') configOutput.value = mapConfigString;
        else if (e.target.value === 'geoviewLayer') configOutput.value = geoviewLayerString;
        else if (e.target.value === 'layerTree') configOutput.value = metadataLayerTreeString;
        else configOutput.value = layerPathErrorFlag;
        generateLineNumbers('configOutput', 'outputLineNumbers');
      });

    // Function used to generate line numbers in the input and output containers.
    generateLineNumbers = (textContainerId, lineNumbersContainerId) => {
      const textarea = document.getElementById(textContainerId);
      const lineNumbersContainer = document.getElementById(lineNumbersContainerId);
      const lines = textarea.value.split('\n').length+1;
      const lineNumbers = Array.from({ length: lines }, (_, index) => '').join('<span />');
      lineNumbersContainer.innerHTML = lineNumbers;
    };

    // Function used to create the string that is used to display the error status of the different layerPath.
    generateLayerPathErrorFlag = (listOfLayerEntryConfig, buffer = '', prefix = '') => {
      listOfLayerEntryConfig.forEach((layer) => {
        buffer = buffer ? `${buffer}\n` : '';
        buffer = `${buffer}${layer.layerPath}: ${layer.errorDetected ? 'ERROR' : 'Ok'}`;
        if (layer.isLayerGroup) buffer = generateLayerPathErrorFlag(layer.listOfLayerEntryConfig, buffer, prefix ? `${prefix}.${layer.layerId}` : layer.layerId);
      });
      return buffer;
    }

    // Config Snippet Selection Button ==========================================================================================

    const configLoader = document.getElementById('configLoader');
    configLoader.addEventListener('change', (e) => {
      // fetch JSON config file to show in the text are section
      function fetchJSONData() {
        fetch(e.target.value)
          .then((res) => {
            if (!res.ok) {
              throw new Error
                (`HTTP error! Status: ${res.status}`);
            }
            return res.text();
          })
          .then((data) => {
            document.getElementById('configGeoview').value = data;

            generateLineNumbers('configGeoview', 'inputLineNumbers');
          })
          .catch((error) =>
            console.error('Unable to fetch data:', error));
      }
      fetchJSONData();
    });
    configLoader.value = './configs/validator/01-simple.json';
    configLoader.dispatchEvent(new Event('change'));

    // Map Config Validate Button ===============================================================================================
    const validateJSONButton = document.getElementById('validateConfig');

      // add an event listener when a button is clicked
      validateJSONButton.addEventListener('click', function (e) {
        // get message element
        const message = document.getElementById('validationMessage');
        const language = document.getElementById('language1').value;
        const configArea = document.getElementById('configGeoview');
        const configOutput = document.getElementById('configOutput');

        // get config and test if JSON is valid
        cgpv.api.configApi.createMapConfig(configArea.value.replaceAll('"', "'").replaceAll("\\'", "\'"), language).then((mapConfig) => {
          mapConfigString = mapConfig.serialize();
          configOutput.value = mapConfig.serialize();
          generateLineNumbers('configOutput', 'outputLineNumbers');
          // set class and message
          message.classList.add('config-json-valid');
          message.classList.remove('config-error');
          if (!mapConfig.errorDetected) {
            message.innerHTML = 'Config is valid, waiting for all service metadata to be read...';
            mapConfig.fetchAllServiceMetadata().then(() => {
              geoviewLayerString = mapConfig.map.listOfGeoviewLayerConfig.reduce((accumulator, geoviewLayer) => {
                return `${accumulator}== ${geoviewLayer.geoviewLayerId} ===============================================================================================\n${geoviewLayer.serialize()}\n`;
              }, '');
              listOfLayerEntryConfig = mapConfig.map.listOfGeoviewLayerConfig.reduce((accumulator, geoviewLayer) => {
                return `${accumulator}== ${geoviewLayer.geoviewLayerId} ===============================================================================================\n${JSON.stringify(geoviewLayer.listOfLayerEntryConfig, undefined, 2)}\n`;
              }, '');
              layerPathErrorFlag = mapConfig.map.listOfGeoviewLayerConfig.reduce((accumulator, geoviewLayer) => {
                return `${accumulator}\n${generateLayerPathErrorFlag(geoviewLayer.listOfLayerEntryConfig, `${geoviewLayer.geoviewLayerId}: ${geoviewLayer.errorDetected? 'ERROR' : 'Ok'}`)}`;
              }, '');
              configOutput.value = mapConfig?.serialize();
              generateLineNumbers('configOutput', 'outputLineNumbers');
              message.innerHTML = 'Config is valid, reading of all service metadata is complete';
              document.getElementById('createMap').disabled = true;
              elementSelector.innerHTML = '<option value="mapConfig">Map Config</option><option value="geoviewLayer">GeoView Layer</option><option value="errorFlags">Error Flags</option>';
              elementSelector.value = 'mapConfig';
              elementSelector.dispatchEvent(new Event('change'));
            }).catch((error) => {
              throw new Error('Error while reading metadata.');
            });
          } else {
            message.innerHTML = 'File is invalid, see console for details...';
          }
        });
      });

    // GeoView Layer Validate Button ==============================================================================================

    const serviceUrlChoices = {
      geoCore: '12acd145-626a-49eb-b850-0a59c9bc7506',
      esriDynamic: 'https://maps-cartes.ec.gc.ca/arcgis/rest/services/CESI/MapServer/',
      esriFeature: 'https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/Temporal_Test_Bed_en/MapServer/',
    };

    const GeoviewLayerTypeDropDown = document.getElementById('geoviewLayerType');
    const sampleUrlDropDown = document.getElementById('sampleUrlSelector');
    const serviceUrlArea = document.getElementById('serviceUrlGeoview');

    sampleUrlDropDown.addEventListener('change', (e) => {
      serviceUrlArea.value = serviceUrlChoices[e.target.value];
      sampleUrlDropDown.value = '';
      serviceUrlArea.dispatchEvent(new Event('keyup'));
    });

    serviceUrlArea.addEventListener('keyup', (e) => {
      GeoviewLayerTypeDropDown.value = cgpv.api.configApi.guessLayerType(serviceUrlArea.value);
      if (!GeoviewLayerTypeDropDown.value) GeoviewLayerTypeDropDown.value = 'unknown';
    });

    serviceUrlArea.value = serviceUrlChoices['geoCore'];
    serviceUrlArea.dispatchEvent(new Event('keyup'));

    const validateServiceURLButton = document.getElementById('validateServiceUrlConfig');

    // add an event listener when the button is clicked
    validateServiceURLButton.addEventListener('click', function (e) {
      // get message element
      const layerType = document.getElementById('geoviewLayerType').value;
      const message = document.getElementById('validationMessage');
      const language = document.getElementById('language2').value;
      const configArea = document.getElementById('configGeoview');
      const serviceUrlArea = document.getElementById('serviceUrlGeoview');
      const configOutput = document.getElementById('configOutput');

      configArea.value = serviceUrlArea.value;
      // get config and test if URL Config is valid
      const returnedValue = cgpv.api.configApi.createLayerConfig(serviceUrlArea.value.trim(), layerType, [], language);
      returnedValue.then((geoviewLayerConfig) => {
        configOutput.value = geoviewLayerConfig?.serialize();
        generateLineNumbers('configOutput', 'outputLineNumbers');

        // set class and message
        message.classList.add('config-json-valid');
        message.classList.remove('config-error');
        if (geoviewLayerConfig && !geoviewLayerConfig.errorDetected) {
          message.innerHTML = 'URL is valid, waiting for service metadata to be read...';

          geoviewLayerConfig.fetchServiceMetadata().then(() => {
            geoviewLayerString = geoviewLayerConfig?.serialize();
            layerPathErrorFlag = generateLayerPathErrorFlag(geoviewLayerConfig.listOfLayerEntryConfig, `${geoviewLayerConfig.geoviewLayerId}: ${geoviewLayerConfig.errorDetected? 'ERROR' : 'Ok'}`);
            message.innerHTML = 'URL is valid, reading of service metadata is complete';
            document.getElementById('createMap').disabled = true;
            elementSelector.innerHTML = '<option value="geoviewLayer">GeoView Layer</option><option value="errorFlags">Error Flags</option>';
            elementSelector.value = 'geoviewLayer';
            elementSelector.dispatchEvent(new Event('change'));
          });
        } else {
          message.innerHTML = 'URL is invalid, see console for details...';
        }
      });
    });

    // Config Url Validate Button =======================================================================================================
    const configUrlArea = document.getElementById('configUrlGeoview');
    configUrlArea.value = configUrlArea.value.trim();
    const validateURLButton = document.getElementById('validateUrlConfig');

      // add an event listener when the button is clicked
      validateURLButton.addEventListener('click', function (e) {
        // get message element
        const message = document.getElementById('validationMessage');
        const configArea = document.getElementById('configGeoview');
        const configUrlArea = document.getElementById('configUrlGeoview');
        const configOutput = document.getElementById('configOutput');

        configArea.value = configUrlArea.value;
        // get config and test if URL Config is valid
        const returnedValue = cgpv.api.configApi.getConfigFromUrl(configUrlArea.value.trim());
        returnedValue.then((mapConfig) => {
          if (!mapConfig.errorDetected) {
            mapConfig.fetchAllServiceMetadata().then(() => {
              configOutput.value = mapConfig.serialize();
              mapConfigString = mapConfig.serialize();
              geoviewLayerString = mapConfig.map.listOfGeoviewLayerConfig.reduce((accumulator, geoviewLayer) => {
                return `${accumulator}== ${geoviewLayer.geoviewLayerId} ===============================================================================================\n${geoviewLayer.serialize()}\n`;
              }, '');
              layerPathErrorFlag = mapConfig.map.listOfGeoviewLayerConfig.reduce((accumulator, geoviewLayer) => {
                return `${accumulator}\n${generateLayerPathErrorFlag(geoviewLayer.listOfLayerEntryConfig, `${geoviewLayer.geoviewLayerId}: ${geoviewLayer.errorDetected? 'ERROR' : 'Ok'}`)}`;
              }, '');
              generateLineNumbers('configOutput', 'outputLineNumbers');

              // set class and message
              message.classList.add('config-json-valid');
              message.classList.remove('config-error');
              message.innerHTML = 'File is valid, see console for details...';
              document.getElementById('createMap').disabled = true;
              elementSelector.innerHTML = '<option value="mapConfig">Map Config</option><option value="geoviewLayer">GeoView Layer</option><option value="errorFlags">Error Flags</option>';
              elementSelector.value = 'mapConfig';
              elementSelector.dispatchEvent(new Event('change'));
            });
          } else {
            message.innerHTML = 'File is invalid, see console for details...';
          }
        });
      });

    // Metadata Layer Tree Button ===============================================================================================

    const GeoviewLayerTypeDropDown2 = document.getElementById('geoviewLayerType2');
    const sampleUrlDropDown2 = document.getElementById('sampleUrlSelector2');
    const serviceUrlArea2 = document.getElementById('serviceUrlGeoview2');

    sampleUrlDropDown2.addEventListener('change', (e) => {
      serviceUrlArea2.value = serviceUrlChoices[e.target.value];
      sampleUrlDropDown2.value = '';
      serviceUrlArea2.dispatchEvent(new Event('keyup'));
    });

    serviceUrlArea2.addEventListener('keyup', (e) => {
      GeoviewLayerTypeDropDown2.value = cgpv.api.configApi.guessLayerType(serviceUrlArea2.value);
      if (!GeoviewLayerTypeDropDown2.value) GeoviewLayerTypeDropDown2.value = 'unknown';
    });

    serviceUrlArea2.value = serviceUrlChoices['geoCore'];
    serviceUrlArea2.dispatchEvent(new Event('keyup'));

    const validateServiceURLButton2 = document.getElementById('validateServiceUrlConfig2');

    // add an event listener when the button is clicked
    validateServiceURLButton2.addEventListener('click', function (e) {
      // get message element
      const layerType = document.getElementById('geoviewLayerType2').value;
      const message = document.getElementById('validationMessage');
      const language = document.getElementById('language3').value;
      const configArea = document.getElementById('configGeoview');
      const serviceUrlArea2 = document.getElementById('serviceUrlGeoview2');
      const configOutput = document.getElementById('configOutput');

      configArea.value = serviceUrlArea2.value;
      // get config and test if URL Config is valid
      const returnedValue = cgpv.api.configApi.createMetadataLayerTree(serviceUrlArea2.value.trim(), layerType, [], language);
      returnedValue.then((metadataLayerTree) => {
        configOutput.value = `${JSON.stringify(metadataLayerTree, undefined, 2)}\n`;
        generateLineNumbers('configOutput', 'outputLineNumbers');

        // set class and message
        if (metadataLayerTree) {
          message.classList.add('config-json-valid');
          message.classList.remove('config-error');
          message.innerHTML = 'URL is valid';
          metadataLayerTreeString = `${JSON.stringify(metadataLayerTree, undefined, 2)}\n`;
          document.getElementById('createMap').disabled = true;
          elementSelector.innerHTML = '<option value="layerTree">Metadata Layer Tree</option>';
          elementSelector.value = 'layerTree';
          elementSelector.dispatchEvent(new Event('change'));
        } else {
          message.classList.remove('config-json-valid');
          message.classList.add('config-error');
          message.innerHTML = 'URL is invalid, see console for details...';
        }
      });
    });

    // Create Button ====================================================================================================================
    const createMapButton = document.getElementById('createMap');
    createMapButton.disabled = true;

      // add an event listener when a button is clicked
      createMapButton.addEventListener('click', function (e) {
        // delete old map
        cgpv.api.maps['sandboxMap']?.remove(true);

        // create new map in a new dom node
        const newDiv = document.createElement('div');
        const a = document.createAttribute('id');
        a.value = 'sandboxMap';
        newDiv.setAttributeNode(a);
        document.getElementById('mapSection').appendChild(newDiv);

        // create map
        cgpv.api.createMapFromConfig('sandboxMap', document.getElementById('configOutput').value);
      });

      const deleteMapButton = document.getElementById('deleteMap');
      deleteMapButton.disabled = true;

      // add an event listener when a button is clicked
      deleteMapButton.addEventListener('click', function (e) {
        // Delete the map
        cgpv.api.maps['sandboxMap'].remove(true);
      });

    // Editor script section ============================================================================================================
    const textarea = document.querySelector('textarea');
    const lineNumbers = document.querySelector('.line-numbers');

      // set default number of lines
      const numberOfLines = textarea.value.split('\n').length;
      lineNumbers.innerHTML = Array(numberOfLines).fill('<span></span>').join('');

      textarea.addEventListener('keyup', (event) => {
        const numberOfLines = event.target.value.split('\n').length;
        lineNumbers.innerHTML = Array(numberOfLines).fill('<span></span>').join('');
      });

      textarea.addEventListener('input', (event) => {
        document.getElementById('createMap').disabled = true;
      });

      // create snippets
      window.addEventListener('load', () => {
        createCodeSnippet();
        createConfigSnippet();
      });
    </script>
  </body>
</html>
