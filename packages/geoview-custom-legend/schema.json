{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
      "legendStructured": {
          "type": "object",
          "properties": {
              "type": {
                  "type": "string",
                  "enum": ["structured"]
              },
              "root": {
                  "$ref": "#/definitions/entryGroup"
              }
          },
          "required": ["type", "root"],
          "additionalProperties": false
      }
  },
  "definitions": {
      "entryGroup": {
          "type": "object",
          "properties": {
              "name": { "type": "string" },
              "hidden": { "type": "boolean", "default": false },
              "expanded": { "type": "boolean", "default": true },
              "children": {
                  "type": "array",
                  "items": {
                      "oneOf": [
                          { "$ref": "#/definitions/entryGroup" },
                          { "$ref": "#/definitions/visibilitySet" },
                          { "$ref": "#/definitions/entry" },
                          { "$ref": "#/definitions/infoSection" }
                      ]
                  },
                  "minItems": 1
              },
              "controls": { "$ref": "#/definitions/legendGroupControls" },
              "disabledControls": { "$ref": "#/definitions/legendGroupControls" }
          },
          "required": ["name", "children"],
          "additionalProperties": false
      },
      "visibilitySet": {
          "type": "object",
          "properties": {
              "collapse": { "type": "boolean", "default": false },
              "exclusiveVisibility": {
                  "type": "array",
                  "items": {
                      "oneOf": [
                          { "$ref": "#/definitions/entryGroup" },
                          { "$ref": "#/definitions/entry" }
                      ]
                  },
                  "minItems": 1
              }
          },
          "required": ["exclusiveVisibility"],
          "additionalProperties": false
      },
      "entry": {
          "type": "object",
          "properties": {
              "layerId": { "type": "string" },
              "hidden": { "type": "boolean", "default": false },
              "controlledIds": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": []
              },
              "entryIndex": { "type": "integer" },
              "entryId": { "type": "string" },
              "coverIcon": { "type": "string" },
              "description": { "type": "string", "default": "" },
              "symbologyStack": { "$ref": "#/definitions/symbologyStack" },
              "symbologyRenderStyle": {
                  "type": "string",
                  "enum": ["icons", "images"]
              },
              "symbologyExpanded": { "type": "boolean", "default": false }
          },
          "required": ["layerId"],
          "additionalProperties": false
      },
      "infoSection": {
          "oneOf": [
              { "type": "object", "properties": { "infoType": { "type": "string", "enum": ["title"] }, "content": { "type": "string" }, "export": { "type": "boolean", "default": true } }, "additionalProperties": false },
              { "type": "object", "properties": { "infoType": { "type": "string", "enum": ["image"] }, "content": { "type": "string" }, "export": { "type": "boolean", "default": true } }, "additionalProperties": false },
              { "type": "object", "properties": { "infoType": { "type": "string", "enum": ["unboundLayer"] }, "content": { "type": "string" }, "coverIcon": { "type": "string" }, "description": { "type": "string", "default": "" }, "symbologyStack": { "$ref": "#/definitions/symbologyStack" }, "symbologyRenderStyle": { "type": "string", "enum": ["icons", "images"] }, "symbologyExpanded": { "type": "boolean", "default": false }, "export": { "type": "boolean", "default": true } }, "additionalProperties": false },
              { "type": "object", "properties": { "infoType": { "type": "string", "enum": ["text"] }, "content": { "type": "string" }, "export": { "type": "boolean", "default": true } }, "additionalProperties": false }
          ],
          "required": ["infoType", "content"]
      },
      "symbologyStack": {
          "type": "array",
          "items": {
              "type": "object",
              "properties": {
                  "image": { "type": "string" },
                  "text": { "type": "string" },
                  "sqlQuery": { "type": "string" }
              },
              "required": ["image", "text"],
              "additionalProperties": false
          },
          "minItems": 1
      },
      "legendGroupControls": {
          "type": "array",
          "items": {
              "type": "string",
              "enum": ["opacity", "visibility", "symbology", "query", "reload", "remove", "settings"]
          },
          "uniqueItems": true
      },
      "legendEntryControls": {
          "type": "array",
          "items": {
              "type": "string",
              "enum": ["opacity", "visibility", "boundingBox", "query", "snapshot", "metadata", "boundaryZoom", "refresh", "reload", "remove", "settings", "data", "styles"]
          },
          "uniqueItems": true
      }
  }
}
